# Slack to GitHub 画像アップロードシステム 実装タスクリスト

## フェーズ1: 環境準備

### Slack App設定
- [ ] Slack Appを作成
- [ ] OAuth Scopesを設定 (files:read, channels:history, chat:write)
- [ ] Event Subscriptionsを有効化
- [ ] file_shared, messageイベントを購読
- [ ] Bot Tokenを取得
- [ ] Signing Secretを取得

### GitHub準備
- [ ] GitHub Personal Access Token生成（repo権限）
- [ ] 対象リポジトリの確認
- [ ] 画像保存先ディレクトリ構造の決定
- [ ] JSONファイルパスの決定

### Cloudflare準備
- [ ] Cloudflareアカウント作成/確認
- [ ] Wrangler CLIインストール
- [ ] Cloudflareアカウントでログイン

## フェーズ2: 基本実装

### プロジェクトセットアップ
- [ ] Cloudflare Workersプロジェクト作成
- [ ] 必要なnpmパッケージのインストール
- [ ] wrangler.toml設定ファイル作成
- [ ] 環境変数の定義

### コア機能実装
- [ ] Slackイベント受信エンドポイント実装
- [ ] Slack署名検証機能実装
- [ ] メッセージパース機能実装（タイトル、日付、リンク抽出）
- [ ] Slack API連携（ファイル情報取得）

### 画像処理
- [ ] 画像ダウンロード処理実装
- [ ] Cloudflare Image Resizing設定
- [ ] リサイズ処理実装（最大幅1200px）
- [ ] JPEG変換処理（品質85%）

### GitHub連携
- [ ] GitHub API認証設定
- [ ] 画像アップロード機能実装
- [ ] JSON読み取り機能実装
- [ ] JSON更新機能実装
- [ ] コミット作成機能実装

## フェーズ3: エラーハンドリング・最適化

### エラーハンドリング
- [ ] Slack API エラーハンドリング
- [ ] 画像処理エラーハンドリング
- [ ] GitHub API エラーハンドリング
- [ ] リトライロジック実装（最大3回）
- [ ] エラー通知機能（Slackへの通知）

### セキュリティ実装
- [ ] Slack署名検証の強化
- [ ] レート制限の実装
- [ ] CORS設定
- [ ] 入力値バリデーション

## フェーズ4: テスト・デプロイ

### テスト
- [ ] ユニットテスト作成
- [ ] Slackイベント受信テスト
- [ ] 画像処理テスト
- [ ] GitHub API連携テスト
- [ ] エンドツーエンドテスト

### デプロイ準備
- [ ] シークレット設定（SLACK_BOT_TOKEN）
- [ ] シークレット設定（SLACK_SIGNING_SECRET）
- [ ] シークレット設定（GITHUB_TOKEN）
- [ ] 環境変数確認（IMAGE_PATH, JSON_PATH）

### 本番デプロイ
- [ ] Cloudflare Workersへのデプロイ
- [ ] エンドポイントURL取得
- [ ] Slack AppのEvent URLを更新
- [ ] 動作確認テスト

## フェーズ5: 運用準備

### ドキュメント作成
- [ ] APIドキュメント作成
- [ ] 運用手順書作成
- [ ] トラブルシューティングガイド作成
- [ ] README.md更新

### モニタリング設定
- [ ] Cloudflare Analytics設定
- [ ] エラーログ監視設定
- [ ] アラート設定
- [ ] パフォーマンスメトリクス確認

### バックアップ・リカバリ
- [ ] JSONファイルバックアップ手順確立
- [ ] リカバリ手順書作成
- [ ] 障害時対応フロー作成

## オプション機能

### 拡張機能
- [ ] Slashコマンド対応
- [ ] 複数画像同時処理対応
- [ ] 画像フォーマット自動判定
- [ ] Workers KV活用（キャッシュ）
- [ ] Webhook通知機能
- [ ] 画像メタデータ保持
- [ ] 重複チェック機能

### 管理機能
- [ ] 管理画面の実装
- [ ] 統計情報表示
- [ ] 手動リトライ機能
- [ ] データエクスポート機能

## 完了条件

以下が全て満たされた状態で完了とする:

1. Slackから画像投稿が正常に受信できる
2. 画像が指定サイズにリサイズされる
3. GitHubリポジトリに画像がアップロードされる
4. JSONファイルが正しく更新される
5. エラー時に適切なエラーハンドリングが行われる
6. Slackに処理結果が通知される
7. 本番環境で安定稼働する

## 見積もり工数

- フェーズ1: 2時間
- フェーズ2: 6時間
- フェーズ3: 4時間
- フェーズ4: 4時間
- フェーズ5: 2時間

**合計: 約18時間**

## 優先順位

1. **必須**: フェーズ1〜4の基本機能
2. **推奨**: フェーズ5の運用準備
3. **任意**: オプション機能

## リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Slack API制限 | 高 | レート制限実装、キャッシュ活用 |
| GitHub API制限 | 中 | バッチ処理、リトライロジック |
| 画像サイズ過大 | 中 | サイズ制限、段階的リサイズ |
| 同時リクエスト | 低 | キュー実装、Workers KV活用 |